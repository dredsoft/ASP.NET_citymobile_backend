function ReloadCommentsGrid(n){$.ajax({type:"POST",url:objCitation.GetCommentsUrl,dataType:"json",data:{citationId:n},success:function(t){var i="",r;if(t.length>0)for(r=0;r<t.length;r++)i=i+'<div class="panel panel-default"><div class="panel-heading" role="tab" id="headingOne"><a role="button" data-parent="#accordion" href="#" aria-expanded="false" aria-controls="collapseTwo">',i=i+'<h4 class="panel-title">'+t[r].createdBy+" added a comment - "+t[r].createdHumanizerDate+'<i class="material-icons" style="float:left">keyboard_arrow_down<\/i>',i=i+'<\/h4><\/a><\/div><div id="'+t[r].commentID+'" aria-labelledby="headingOne">',i=i+'<div class="panel-body">'+t[r].comment,t[r].enableEdit&&(i=i+'<br/><a href="javascript:void(0)" CitationID="'+n+'" CommentID="'+t[r].commentID+'" class="blue-link editComment">Edit<\/a>',i=i+' <a href="javascript:void(0)" CitationID="'+n+'" CommentID="'+t[r].commentID+'" class="blue-link DeleteComment">Delete<\/a>'),i=i+"<\/div><\/div><\/div>";$("#accordion").html(i)},cache:!0})}function removeQString(n){var t=document.location.href,i=location.search;n!=""?(oldValue=getParameterByName(n),removeVal=n+"="+oldValue,t=t.replace(i,"")):(i=location.search,t=t.replace(i,""));history.pushState({state:1,rand:Math.random()},"",t)}function getParameterByName(n){n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+n+"=([^&#]*)"),t=i.exec(location.search);return t===null?"":decodeURIComponent(t[1].replace(/\+/g," "))}var citation={IsRejected:!1,ChangeStatus:function(n){var t=$("#ddlStatus").attr("citationId"),i=$("#ddlStatus").val();blockUI();$.ajax({type:"POST",url:objCitation.CitationUrl,dataType:"json",data:{CitationId:t,StatusId:i,Reason:n},success:function(){$(".alert").length>0||demo.showNotification("success","Status Updated.");var n=$("#ddlStatus option:selected").text();citation.HideStatus(n);window.location.reload()},cache:!0})},UnassignUser:function(){var n=$("#ddlAssignedTo").attr("citationId");$.ajax({type:"POST",url:objCitation.UnassignUrl,dataType:"json",data:{citationId:n},success:function(){$(".alert").length>0||demo.showNotification("success","User has been Unassigned.");$("#ddlAssignedTo").val("0")},cache:!0})},GetUrlByAttachment:function(n,t){var i=objCitation.s3BucketUrl+n;t=="video"?html='<video width="100%" height="300" controls><source src="'+i+'" type="video/mp4"><\/video>':t=="image"&&(html='<center><img class="img-responsive" src="'+i+'"/><\/center>');swal({html:html,confirmButtonColor:"#3085d6",confirmButtonClass:"btn btn-success",buttonsStyling:!1}).then(function(){})},HideStatus:function(n){n=="Approved"?$('#ddlStatus option[value="1"]').remove():n=="In Review"&&($('#ddlStatus option[value="1"]').remove(),$('#ddlStatus option[value="2"]').remove());(n=="Closed"||n=="Rejected")&&(document.getElementById("divStatus").innerHTML='<label class="">'+n+"<\/label>")},AttachmentDelete:function(n){blockUI();$.ajax({type:"POST",url:objCitation.DeleteAttachment,dataType:"json",data:{attachmentId:n},success:function(n){n.success==!0?$(".alert").length>0||(demo.showNotification("success",n.message),location.reload()):$(".alert").length>0||demo.showNotification("danger",n.message);unblockUI()},cache:!0})},SaveComment:function(n,t){$.ajax({type:"POST",url:objCitation.SaveCommentUrl,dataType:"json",async:!1,data:{citationId:n,commentId:$("#hdnCommentId").val(),comment:t,isPublic:$("#chkIsPublic").is(":checked")},success:function(){citation.IsRejected==!1&&($(".alert").length>0||demo.showNotification("success","Comment saved successfully"),$("#btnAddComment").text("ADD COMMENT"),$("#btnCancelComment").hide(),$("#txtComment").val(""),$("#hdnCommentId").val(""),$("#chkIsPublic").prop("checked",!1));ReloadCommentsGrid(n)},cache:!0})},Reasons:function(){swal({title:"Reject Reason",html:'<div class="col-sm-10"><div class="row"><div class="form-group" > <select id="ddlReason" class="form-control"><option value="">Select Reason<\/option><option value="Sorry, we couldn\'t clearly see the license plate in your video and therefore could not approve it. Next time be sure to zoom in and clearly capture it.">License Plate<\/option><option value="Sorry, we couldn\'t clearly see the driver in the video using a mobile device and therefore could not approve it.">Mobile Device<\/option><option value="Sorry, We couldn\'t approve your video as it appears you were driving while filming.Please note that this is illegal and a violation of our terms of use. Any additional videos you submit while driving will be grounds for the termination of your account.">User driving<\/option><option value="">Other<\/option><\/select><span id="spnReasonValidation" class="text-danger"><\/span><\/div><\/div><div class="row"> <div class="form-group label-floating"> <label  class="control-label"><\/label><textarea id="txtReason" style="height:60px !important" class="form-control"><\/textarea><\/div><\/div><\/div>',showCancelButton:!0,confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger",buttonsStyling:!1,closeOnConfirm:!1,preConfirm:function(){if($("#ddlReason").val()!="")return new Promise(function(n){citation.IsRejected=!0;var t=$("#ddlStatus").attr("citationId");$("#hdnCommentId").val("");blockUI();citation.SaveComment(t,$("#txtReason").val());citation.ChangeStatus($("#txtReason").val());unblockUI();n()});$("#spnReasonValidation").text("This field is required");$(".swal2-confirm").attr("disabled",!1);$(".swal2-cancel").attr("disabled",!1)}}).then(function(){})},SaveVideoAttachment:function(n,t,i,r){blockUI();$.ajax({type:"POST",url:objCitation.SaveVideoAttachment,dataType:"json",async:!0,data:{Time:n,Src:t,VideoId:i,CitationNumber:objCitation.citationNumber,CitationId:r},success:function(n){n.success==!0&&($(".alert").length>0||demo.showNotification("success","Image Captured Successfully."));location.reload()},cache:!0})},Message:function(n,t){swal({title:"Send Message",html:'<div class="col-sm-10"><div class="row"> <div class="form-group label-floating"> <label  class="control-label"><\/label><textarea id="txtMessage" placeholder="Message" style="height:60px !important" class="form-control"><\/textarea><span id="spnMessage" class="text-danger"><\/span><\/div><\/div><\/div>',showCancelButton:!0,confirmButtonText:"Send",confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger",buttonsStyling:!1,closeOnConfirm:!1,preConfirm:function(){if($("#txtMessage").val()!="")return new Promise(function(i){var r=n;blockUI();i();citation.SendMessage(r,t,$("#txtMessage").val());unblockUI()});$("#spnMessage").text("This field is required");$(".swal2-confirm").attr("disabled",!1);$(".swal2-cancel").attr("disabled",!1)}}).then(function(){})},SendMessage:function(n,t,i){$.ajax({type:"POST",url:objCitation.SendMessageUrl,dataType:"json",async:!0,data:{message:i,recipient:n,displayName:t},success:function(n){n.success===!0?$(".alert").length>0||demo.showNotification("success","Message Sent"):demo.showNotification("danger",n.message)},cache:!0})},DeleteCitation:function(n){blockUI();$.ajax({type:"POST",url:objCitation.DeleteCitationUrl,dataType:"json",data:{id:n},success:function(n){n.success==!0?window.location.href=objCitation.GetCitationUrl:$(".alert").length>0||demo.showNotification("danger",n.message);unblockUI()},cache:!0})}};$(document).ready(function(){var n=$("#hdnUploadMessage").val(),t,i;n!=""&&(n=="File Uploaded Successfully."||n=="File Deleted Successfully."||n=="Updated"?$(".alert").length>0||demo.showNotification("success",n):$(".alert").length>0||demo.showNotification("danger",n),removeQString("message"));t=$("#ddlStatus option:selected").text();i=$("#ddlStatus").val();citation.HideStatus(t);$("#btnSaveImage").click(function(){var n=document.getElementById("citationVideo"),t=n.currentTime,i=$("#videoSrc").attr("src"),r=$(this).attr("VideoAttachmentId"),u=$(this).attr("citationId");citation.SaveVideoAttachment(t,i,r,u)});$("#ddlStatus").change(function(){var n=$("#ddlStatus option:selected").text();swal({title:"Are you sure?",text:"You are changing the status from "+t+" to "+n,type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes",cancelButtonText:"No",confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger",buttonsStyling:!1}).then(function(){n!="Rejected"?citation.ChangeStatus(""):citation.Reasons()},function(n){n==="cancel"&&$("#ddlStatus").val(i)})});$("#ddlAssignedTo").change(function(){var t=$(this).attr("citationId"),n=$(this).val();n!="0"&&(blockUI(),$.ajax({type:"POST",url:objCitation.AssignUrl,dataType:"json",data:{citationId:t,assignToId:n},success:function(){if(!($(".alert").length>0)){var n=$("#ddlAssignedTo option:selected").text();demo.showNotification("success","Assignment complete. An email has been sent to "+n)}unblockUI()},cache:!0}))});$("#btnCancelComment").click(function(){$("#btnAddComment").text("ADD COMMENT");$("#btnCancelComment").hide();$("#txtComment").val("");$("#hdnCommentId").val("");$("#chkIsPublic").prop("checked",!1)});$("#btnAddComment").click(function(){if($("#txtComment").val().trim()!=""){var n=$(this).attr("citationId"),t=$("#txtComment").val();citation.SaveComment(n,t)}else demo.showNotification("danger","Enter Comment")});$(document).on("click",".editComment",function(){var t=$(this).attr("citationId"),n=$(this).attr("CommentID");$.ajax({type:"POST",url:objCitation.EditCommentUrl,dataType:"json",data:{commentId:n},success:function(n){n.comment!=""?($("#txtComment").val(n.comment),$("#chkIsPublic").prop("checked",n.isPublic),$("#hdnCommentId").val(n.commentID),$("#btnAddComment").text("UPDATE"),$("#btnCancelComment").show(),$("#txtComment").focus()):demo.showNotification("danger","You can't edit this comment")},cache:!0})});$(document).on("click",".DeleteComment",function(){var n=$(this).attr("citationId"),t=$(this).attr("CommentID");$.ajax({type:"POST",url:objCitation.DeleteCommentUrl,dataType:"json",data:{commentId:t},success:function(t){t=="1"?(demo.showNotification("success","Deleted successfully"),ReloadCommentsGrid(n)):demo.showNotification("danger","You can't delete this comment")},cache:!0})});$("#lnkUnassign").click(function(){$("#ddlAssignedTo").val()!="0"?citation.UnassignUser():$(".alert").length>0||demo.showNotification("warning","No User Assigned.")});$("body").keypress(function(n){if(n.which==13)return $("#btnAddComment").click(),!1});$(".lnkDisplayAttachment").click(function(){var n=$(this).parent().find("input[type='hidden']").val(),t=$(this).attr("attachmenttype");citation.GetUrlByAttachment(n,t)});$("#GetCitationZip").click(function(){blockUI();var n=$(this).attr("citationId"),t=$(this).attr("citationNumber");$.ajax({type:"POST",url:objCitation.SendEvidencePackage,dataType:"json",data:{citationId:n,citationNumber:t},success:function(n){n?(demo.showNotification("success","Package Created."),window.reload()):demo.showNotification("danger","No media available");unblockUI()},cache:!0})});$(document).on("click",".clsDeleteAttachment",function(){var n=$(this).attr("attachmentId");swal({title:"Are you sure?",text:"You are about to permanently delete.",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"YES",cancelButtonText:"NO",confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger",buttonsStyling:!1}).then(function(){citation.AttachmentDelete(n)},function(n){n==="cancel"})});$(document).on("change","#ddlReason",function(){$(this).val()!=""?($("#txtReason").val($(this).val()),$("#spnReasonValidation").text("")):$("#txtReason").val("")});$(document).on("click","#btnDeleteCitation",function(){swal({title:"Are you sure?",text:"This will permanently delete the citation",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes",cancelButtonText:"No",confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger",buttonsStyling:!1}).then(function(){var n=$("#btnDeleteCitation").attr("citationId");citation.DeleteCitation(n)},function(n){n==="cancel"})});$(document).on("click","#sndMessage",function(){var n=$(this).attr("email"),t=$(this).attr("displayName");citation.Message(n,t)});demo.initFormExtendedDatetimepickers()});window.initMap=function(){var n={lat:objCitation.varlat,lng:objCitation.varlng},t=new google.maps.Map(document.getElementById("map"),{zoom:18,center:n,mapTypeId:google.maps.MapTypeId.SATELLITE}),i=new google.maps.Marker({position:n,map:t})};